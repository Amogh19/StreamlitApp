import streamlit as st
import pandas as pd
import plotly.express as px

# Set page configuration
st.set_page_config(page_title="Quick Dashboard", layout="wide")

st.title("üìä Data Explorer Dashboard")
st.markdown("Upload your dataset to generate instant insights.")

# File Uploader
uploaded_file = st.sidebar.file_uploader("Choose a CSV or Excel file", type=['csv', 'xlsx'])

if uploaded_file is not None:
    # Load data
    if uploaded_file.name.endswith('.csv'):
        df = pd.read_csv(uploaded_file)
    else:
        df = pd.read_excel(uploaded_file)

    # --- Sidebar Filters ---
    st.sidebar.header("Filter Data")
    # Automatically pick the first categorical column for a filter
    obj_cols = df.select_dtypes(include=['object']).columns.tolist()
    if obj_cols:
        filter_col = st.sidebar.selectbox("Select Column to Filter", obj_cols)
        selection = st.sidebar.multiselect(f"Select {filter_col}", options=df[filter_col].unique(), default=df[filter_col].unique())
        df = df[df[filter_col].isin(selection)]

    # --- Main Metrics ---
    num_cols = df.select_dtypes(include=['number']).columns.tolist()
    
    col1, col2, col3 = st.columns(3)
    col1.metric("Total Rows", len(df))
    if len(num_cols) >= 1:
        col2.metric(f"Avg {num_cols[0]}", round(df[num_cols[0]].mean(), 2))
    if len(num_cols) >= 2:
        col3.metric(f"Sum {num_cols[1]}", round(df[num_cols[1]].sum(), 2))

    st.divider()

    # --- Visualizations ---
    c1, c2 = st.columns(2)

    with c1:
        st.subheader("Distribution Analysis")
        target_num = st.selectbox("Select Numeric Column", num_cols)
        fig_hist = px.histogram(df, x=target_num, template="plotly_white", color_discrete_sequence=['#00CC96'])
        st.plotly_chart(fig_hist, use_container_width=True)

    with c2:
        st.subheader("Category Breakdown")
        if obj_cols:
            target_cat = st.selectbox("Select Category Column", obj_cols)
            fig_pie = px.pie(df, names=target_cat, hole=0.4)
            st.plotly_chart(fig_pie, use_container_width=True)

    # --- Data Table ---
    with st.expander("View Raw Data"):
        st.dataframe(df)

else:
    st.info("‚òùÔ∏è Please upload a file in the sidebar to get started!")
